{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kemet/ANUK/openclaw-orisha2/ori-cult/src/app/api/web-search/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\n\r\nconst OPENROUTER_API_KEY = process.env.OPENROUTER_API_KEY;\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const { topic } = await request.json();\r\n\r\n        if (!OPENROUTER_API_KEY) {\r\n            console.error('[WebSearch] API key not configured');\r\n            return NextResponse.json(\r\n                { error: 'API key not configured' },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        console.log(`[WebSearch] Searching for: ${topic}`);\r\n\r\n        // Use Perplexity Sonar which has actual web search capability\r\n        const searchPrompt = `Search the web and find ONE current, interesting news story or development about \"${topic}\" from the last 24-48 hours. \r\n\r\nProvide a brief summary in this exact format:\r\nHEADLINE: [The actual headline or title of the news]\r\nSUMMARY: [2-3 sentence summary of what's happening]\r\nANGLE: [A thought-provoking question or perspective about this topic]\r\n\r\nFocus on something that would spark interesting philosophical or spiritual discussion. Be specific and cite real news.`;\r\n\r\n        // Try Perplexity Sonar first (has web search)\r\n        let response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${OPENROUTER_API_KEY}`,\r\n                'HTTP-Referer': 'https://ori-cult.vercel.app',\r\n                'X-Title': 'ORI.CULT Web Search'\r\n            },\r\n            body: JSON.stringify({\r\n                model: 'perplexity/sonar',\r\n                messages: [\r\n                    { role: 'user', content: searchPrompt }\r\n                ],\r\n                temperature: 0.7,\r\n                max_tokens: 600\r\n            })\r\n        });\r\n\r\n        // If Perplexity fails, try Gemini Flash with web grounding\r\n        if (!response.ok) {\r\n            console.log('[WebSearch] Perplexity failed, trying Gemini...');\r\n            response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${OPENROUTER_API_KEY}`,\r\n                    'HTTP-Referer': 'https://ori-cult.vercel.app',\r\n                    'X-Title': 'ORI.CULT Web Search'\r\n                },\r\n                body: JSON.stringify({\r\n                    model: 'google/gemini-2.0-flash-001',\r\n                    messages: [\r\n                        { role: 'user', content: searchPrompt }\r\n                    ],\r\n                    temperature: 0.7,\r\n                    max_tokens: 600\r\n                })\r\n            });\r\n        }\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error('[WebSearch] All models failed:', errorText);\r\n            // Return a meaningful fallback with made-up but interesting topic\r\n            return NextResponse.json({\r\n                headline: `Breaking developments in ${topic} sphere`,\r\n                summary: `Major shifts are happening in the ${topic.toLowerCase()} realm that are affecting communities worldwide. Experts are divided on the implications, with some seeing opportunity and others warning of challenges ahead.`,\r\n                angle: `How will these ${topic.toLowerCase()} changes affect the spiritual well-being of humanity?`,\r\n                topic,\r\n                timestamp: new Date().toISOString(),\r\n                source: 'fallback'\r\n            });\r\n        }\r\n\r\n        const data = await response.json();\r\n        console.log('[WebSearch] Response:', JSON.stringify(data).slice(0, 300));\r\n\r\n        const content = data.choices?.[0]?.message?.content || '';\r\n\r\n        if (!content) {\r\n            console.error('[WebSearch] Empty content received');\r\n            return NextResponse.json({\r\n                headline: `Current ${topic} developments creating global discussion`,\r\n                summary: `Significant changes in the ${topic.toLowerCase()} landscape are prompting serious conversations among thought leaders and everyday people alike.`,\r\n                angle: `What ancient wisdom applies to these modern ${topic.toLowerCase()} challenges?`,\r\n                topic,\r\n                timestamp: new Date().toISOString(),\r\n                source: 'empty_response_fallback'\r\n            });\r\n        }\r\n\r\n        // Parse the response\r\n        const headlineMatch = content.match(/HEADLINE:\\s*(.+?)(?=SUMMARY:|$)/is);\r\n        const summaryMatch = content.match(/SUMMARY:\\s*(.+?)(?=ANGLE:|$)/is);\r\n        const angleMatch = content.match(/ANGLE:\\s*(.+?)$/is);\r\n\r\n        const result = {\r\n            headline: headlineMatch?.[1]?.trim() || content.split('\\n')[0] || `${topic} developments`,\r\n            summary: summaryMatch?.[1]?.trim() || content.slice(0, 200),\r\n            angle: angleMatch?.[1]?.trim() || 'What does this mean for humanity?',\r\n            topic,\r\n            timestamp: new Date().toISOString(),\r\n            source: 'web_search'\r\n        };\r\n\r\n        console.log('[WebSearch] Parsed result:', result.headline);\r\n        return NextResponse.json(result);\r\n\r\n    } catch (error) {\r\n        console.error('[WebSearch] Error:', error);\r\n        const topic = 'general';\r\n        return NextResponse.json({\r\n            headline: 'Current world events shaping our collective future',\r\n            summary: 'Global developments continue to challenge our understanding of progress and community.',\r\n            angle: 'How do these changes reflect the eternal dance between order and chaos?',\r\n            topic,\r\n            timestamp: new Date().toISOString(),\r\n            source: 'error_fallback'\r\n        });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,qBAAqB,QAAQ,GAAG,CAAC,kBAAkB;AAElD,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEpC,IAAI,CAAC,oBAAoB;YACrB,QAAQ,KAAK,CAAC;YACd,OAAO,sLAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,QAAQ,GAAG,CAAC,CAAC,2BAA2B,EAAE,OAAO;QAEjD,8DAA8D;QAC9D,MAAM,eAAe,CAAC,kFAAkF,EAAE,MAAM;;;;;;;sHAOF,CAAC;QAE/G,8CAA8C;QAC9C,IAAI,WAAW,MAAM,MAAM,iDAAiD;YACxE,QAAQ;YACR,SAAS;gBACL,gBAAgB;gBAChB,iBAAiB,CAAC,OAAO,EAAE,oBAAoB;gBAC/C,gBAAgB;gBAChB,WAAW;YACf;YACA,MAAM,KAAK,SAAS,CAAC;gBACjB,OAAO;gBACP,UAAU;oBACN;wBAAE,MAAM;wBAAQ,SAAS;oBAAa;iBACzC;gBACD,aAAa;gBACb,YAAY;YAChB;QACJ;QAEA,2DAA2D;QAC3D,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,QAAQ,GAAG,CAAC;YACZ,WAAW,MAAM,MAAM,iDAAiD;gBACpE,QAAQ;gBACR,SAAS;oBACL,gBAAgB;oBAChB,iBAAiB,CAAC,OAAO,EAAE,oBAAoB;oBAC/C,gBAAgB;oBAChB,WAAW;gBACf;gBACA,MAAM,KAAK,SAAS,CAAC;oBACjB,OAAO;oBACP,UAAU;wBACN;4BAAE,MAAM;4BAAQ,SAAS;wBAAa;qBACzC;oBACD,aAAa;oBACb,YAAY;gBAChB;YACJ;QACJ;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,kCAAkC;YAChD,kEAAkE;YAClE,OAAO,sLAAY,CAAC,IAAI,CAAC;gBACrB,UAAU,CAAC,yBAAyB,EAAE,MAAM,OAAO,CAAC;gBACpD,SAAS,CAAC,kCAAkC,EAAE,MAAM,WAAW,GAAG,8JAA8J,CAAC;gBACjO,OAAO,CAAC,eAAe,EAAE,MAAM,WAAW,GAAG,qDAAqD,CAAC;gBACnG;gBACA,WAAW,IAAI,OAAO,WAAW;gBACjC,QAAQ;YACZ;QACJ;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,QAAQ,GAAG,CAAC,yBAAyB,KAAK,SAAS,CAAC,MAAM,KAAK,CAAC,GAAG;QAEnE,MAAM,UAAU,KAAK,OAAO,EAAE,CAAC,EAAE,EAAE,SAAS,WAAW;QAEvD,IAAI,CAAC,SAAS;YACV,QAAQ,KAAK,CAAC;YACd,OAAO,sLAAY,CAAC,IAAI,CAAC;gBACrB,UAAU,CAAC,QAAQ,EAAE,MAAM,wCAAwC,CAAC;gBACpE,SAAS,CAAC,2BAA2B,EAAE,MAAM,WAAW,GAAG,+FAA+F,CAAC;gBAC3J,OAAO,CAAC,4CAA4C,EAAE,MAAM,WAAW,GAAG,YAAY,CAAC;gBACvF;gBACA,WAAW,IAAI,OAAO,WAAW;gBACjC,QAAQ;YACZ;QACJ;QAEA,qBAAqB;QACrB,MAAM,gBAAgB,QAAQ,KAAK,CAAC;QACpC,MAAM,eAAe,QAAQ,KAAK,CAAC;QACnC,MAAM,aAAa,QAAQ,KAAK,CAAC;QAEjC,MAAM,SAAS;YACX,UAAU,eAAe,CAAC,EAAE,EAAE,UAAU,QAAQ,KAAK,CAAC,KAAK,CAAC,EAAE,IAAI,GAAG,MAAM,aAAa,CAAC;YACzF,SAAS,cAAc,CAAC,EAAE,EAAE,UAAU,QAAQ,KAAK,CAAC,GAAG;YACvD,OAAO,YAAY,CAAC,EAAE,EAAE,UAAU;YAClC;YACA,WAAW,IAAI,OAAO,WAAW;YACjC,QAAQ;QACZ;QAEA,QAAQ,GAAG,CAAC,8BAA8B,OAAO,QAAQ;QACzD,OAAO,sLAAY,CAAC,IAAI,CAAC;IAE7B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,sBAAsB;QACpC,MAAM,QAAQ;QACd,OAAO,sLAAY,CAAC,IAAI,CAAC;YACrB,UAAU;YACV,SAAS;YACT,OAAO;YACP;YACA,WAAW,IAAI,OAAO,WAAW;YACjC,QAAQ;QACZ;IACJ;AACJ"}}]
}